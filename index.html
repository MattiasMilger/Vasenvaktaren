<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Väsenväktaren</title>
    <link rel="stylesheet" href="styles/main.css">
</head>
<body>
    <!-- Message Container for Toasts -->
    <div id="message-container" class="message-container"></div>

    <!-- Main Menu Screen -->
    <div id="main-menu-screen" class="screen active">
        <div class="main-menu-content">
            <h1 class="game-title">Väsenväktaren</h1>
            <p class="game-subtitle">Catch creatures of Swedish folklore</p>
            <div class="menu-buttons">
                <button id="new-game-btn" class="btn btn-primary">New Game</button>
                <button id="continue-btn" class="btn btn-secondary">Continue</button>
            </div>
        </div>
    </div>

    <!-- Starter Selection Screen -->
    <div id="starter-select-screen" class="screen">
        <div class="starter-content">
            <p class="starter-intro">You find yourself in a strange forest.</p>
            <p class="starter-prompt">Choose who to befriend:</p>
            <div id="starter-options" class="starter-options"></div>
            <button id="confirm-starter-btn" class="btn btn-primary" disabled>Confirm</button>
        </div>
    </div>

    <!-- Game Screen -->
    <div id="game-screen" class="screen">
        <!-- Header -->
        <header class="game-header">
            <div class="header-left">
                <h1 class="header-title">Väsenväktaren</h1>
                <span class="header-subtitle">Catch creatures of Swedish folklore</span>
            </div>
            <div class="header-center">
                <div id="player-profile" class="player-profile" title="Click to view profile">
                    <span id="player-name-display">Väktare</span>
                </div>
            </div>
            <div class="header-right">
                <button id="combat-tips-btn" class="btn btn-small">Combat Tips</button>
                <button id="settings-btn" class="btn btn-small">Settings</button>
            </div>
        </header>

        <!-- Main Game Content -->
        <main class="game-main">
            <!-- Left Panel - Inventory -->
            <aside class="panel panel-left">
                <div class="panel-tabs">
                    <button id="tab-vasen" class="tab-btn active" data-tab="vasen">Väsen</button>
                    <button id="tab-runes" class="tab-btn" data-tab="runes">Runes</button>
                    <button id="tab-items" class="tab-btn" data-tab="items">Items</button>
                </div>
                <div class="panel-content">
                    <!-- Väsen Tab -->
                    <div id="inventory-vasen" class="tab-content active"></div>
                    <!-- Runes Tab -->
                    <div id="inventory-runes" class="tab-content"></div>
                    <!-- Items Tab -->
                    <div id="inventory-items" class="tab-content"></div>
                </div>
                <!-- Vasen Details Panel -->
                <div id="vasen-details-panel" class="vasen-details-panel"></div>
            </aside>

            <!-- Middle Panel - World & Party -->
            <section class="panel panel-middle">
                <div class="party-section">
                    <h3 class="section-title">Active Party</h3>
                    <div class="party-slots">
                        <div id="party-slot-0" class="party-slot" data-slot="0">
                            <span class="slot-label">Lead</span>
                            <div class="slot-content empty">Empty</div>
                        </div>
                        <div id="party-slot-1" class="party-slot" data-slot="1">
                            <span class="slot-label">Slot 2</span>
                            <div class="slot-content empty">Empty</div>
                        </div>
                        <div id="party-slot-2" class="party-slot" data-slot="2">
                            <span class="slot-label">Slot 3</span>
                            <div class="slot-content empty">Empty</div>
                        </div>
                    </div>
                </div>
                <div class="zone-section">
                    <h3 class="section-title">Zones</h3>
                    <div id="zone-list" class="zone-list"></div>
                    <div class="zone-actions">
                        <button id="explore-btn" class="btn btn-primary btn-large" disabled>Explore</button>
                        <button id="challenge-btn" class="btn btn-secondary" disabled>Challenge Guardian</button>
                    </div>
                </div>
            </section>

            <!-- Right Panel - Action/Combat Area -->
            <section class="panel panel-right">
                <div id="zone-description" class="zone-description">
                    <p class="no-zone-msg">Select a zone to begin exploring.</p>
                </div>
                <div id="combat-area" class="combat-area" style="display: none;">
                    <div class="combat-header">
                        <span id="turn-counter" class="turn-counter">Turn 1</span>
                    </div>
                    <div id="combat-ui" class="combat-ui">
                        <div class="combat-arena">
                            <div id="player-panel" class="combatant-panel player-side"></div>
                            <div class="combat-versus">VS</div>
                            <div id="enemy-panel" class="combatant-panel enemy-side"></div>
                        </div>
                    </div>
                    <div id="combat-log" class="combat-log"></div>
                    <div id="ability-buttons" class="ability-buttons"></div>
                    <div class="action-buttons">
                        <button id="btn-swap" class="btn btn-action">Swap</button>
                        <button id="btn-offer" class="btn btn-action">Offer Item</button>
                        <button id="btn-ask" class="btn btn-action">Ask About Item</button>
                        <button id="btn-pass" class="btn btn-action">Pass</button>
                        <button id="btn-surrender" class="btn btn-danger">Surrender</button>
                    </div>
                    <div id="swap-options" class="swap-options"></div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="game-footer">
            <span>Developer: Mattias Milger</span>
            <span class="footer-sep">|</span>
            <a href="mailto:mattias.r.milger@gmail.com">mattias.r.milger@gmail.com</a>
            <span class="footer-sep">|</span>
            <a href="https://github.com/MattiasMilger/Vasenvaktaren" target="_blank" title="View source code and star the project on GitHub.">GitHub</a>
        </footer>
    </div>

    <!-- Modals -->
    
    <!-- Ally Selection Modal -->
    <div id="ally-select-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Select Target for <span id="ally-select-ability-name"></span></h3>
                <button id="close-ally-select-modal" class="modal-close">×</button>
            </div>
            <div class="modal-body">
                <div id="ally-select-list"></div>
            </div>
        </div>
    </div>

    <!-- Swap Modal -->
<div id="swap-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Choose a Väsen to Swap In</h3>
            <button id="close-swap-modal" class="modal-close">×</button>
        </div>
        <div class="modal-body">
            <div id="swap-modal-list"></div>
        </div>
    </div>
</div>
    
    <!-- Dialogue Modal -->
    <div id="dialogue-modal" class="modal">
        <div class="modal-content modal-dialogue">
            <h3 id="dialogue-title" class="modal-title"></h3>
            <p id="dialogue-message" class="dialogue-message"></p>
            <div id="dialogue-buttons" class="dialogue-buttons"></div>
        </div>
    </div>

    <!-- Offer Item Modal -->
    <div id="offer-modal" class="modal">
        <div class="modal-content modal-offer">
            <h3 class="modal-title">Offer Item</h3>
            <div id="offer-item-list" class="offer-item-list"></div>
            <button id="close-offer-modal" class="btn btn-secondary">Cancel</button>
        </div>
    </div>

    <!-- Heal Väsen Modal -->
    <div id="heal-vasen-modal" class="modal">
        <div class="modal-content modal-heal">
            <h3 class="modal-title">Use Item to Heal</h3>
            <div id="heal-vasen-list" class="heal-vasen-list"></div>
            <button id="close-heal-modal" class="btn btn-secondary">Cancel</button>
        </div>
    </div>

    <!-- Knockout Swap Modal -->
    <div id="knockout-swap-modal" class="modal">
        <div class="modal-content modal-swap">
            <h3 class="modal-title">Your Väsen has fainted! Select next Väsen:</h3>
            <div id="knockout-swap-list" class="swap-vasen-list"></div>
        </div>
    </div>

    <!-- Rune Equip Modal (select which vasen to equip rune to) -->
    <div id="rune-equip-modal" class="modal">
        <div class="modal-content modal-rune">
            <h3 class="modal-title">Equip Rune to Party Väsen</h3>
            <div id="rune-equip-list" class="rune-equip-list"></div>
            <button id="close-rune-equip-modal" class="btn btn-secondary">Cancel</button>
        </div>
    </div>

    <!-- Rune to Vasen Modal (manage runes on specific vasen) -->
    <div id="rune-to-vasen-modal" class="modal">
        <div class="modal-content modal-rune">
            <h3 class="modal-title">Manage Runes</h3>
            <div id="rune-to-vasen-list" class="rune-to-vasen-list"></div>
            <button id="close-rune-to-vasen-modal" class="btn btn-secondary">Close</button>
        </div>
    </div>

    <!-- Add Vasen to Party Modal -->
<div id="add-vasen-modal" class="modal">
    <div class="modal-content modal-rune">
        <h3 class="modal-title">Choose a Väsen</h3>
        <div id="add-vasen-list" class="rune-to-vasen-list"></div>
        <button id="close-add-vasen-modal" class="btn btn-secondary">Close</button>
    </div>
</div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content modal-settings">
            <h3 class="modal-title">Settings</h3>
            <div class="settings-section">
                <h4>Save Management</h4>
                <p class="settings-note">Game auto-saves.</p>
                <div class="save-buttons">
                    <button id="export-save-btn" class="btn btn-secondary">Export Save</button>
                    <button id="import-save-btn" class="btn btn-secondary">Import Save</button>
                </div>
                <textarea id="import-save-data" class="import-textarea" placeholder="Paste save data here..." style="display: none;"></textarea>
                <button id="confirm-import-btn" class="btn btn-primary" style="display:none;">Import Now</button>

                <button id="reset-game-btn" class="btn btn-danger">Reset Game</button>
            </div>
            <button id="close-settings" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profile-modal" class="modal">
        <div class="modal-content modal-profile">
            <h3 class="modal-title">Player Profile</h3>
            <div id="profile-content" class="profile-content">
                <!-- Profile content rendered by JS -->
            </div>
            <button id="change-name-btn" style="display: none;"></button>
            <button id="close-profile" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Combat Tips Modal -->
    <div id="combat-tips-modal" class="modal">
        <div class="modal-content modal-tips">
            <h3 class="modal-title">Combat Tips</h3>
            <div class="tips-content">
                <h4>Taming</h4>
                <p>Tame a Väsen by offering it its desired item, and then defeating it. Find out the desired item by careful reading or asking the Väsen.</p>
                <h4>Runes</h4>
                <p>Equip runes to your Väsen for powerful effects. At lvl 30, they gain the ability to equip two runes.</p>
                
                <h4>Element Matchups</h4>
                <p class="matrix-legend"><span class="legend-potent">P = Potent (1.4x)</span> <span class="legend-neutral">N = Neutral (1.0x)</span> <span class="legend-weak">W = Weak (0.7x)</span></p>
                <table class="element-matrix">
                    <thead>
                        <tr>
                            <th>Atk ↓ Def →</th>
                            <th class="element-earth">Earth</th>
                            <th class="element-nature">Nature</th>
                            <th class="element-water">Water</th>
                            <th class="element-fire">Fire</th>
                            <th class="element-wind">Wind</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th class="element-earth">Earth</th>
                            <td class="neutral">N</td>
                            <td class="weak">W</td>
                            <td class="neutral">N</td>
                            <td class="potent">P</td>
                            <td class="potent">P</td>
                        </tr>
                        <tr>
                            <th class="element-nature">Nature</th>
                            <td class="potent">P</td>
                            <td class="neutral">N</td>
                            <td class="potent">P</td>
                            <td class="weak">W</td>
                            <td class="weak">W</td>
                        </tr>
                        <tr>
                            <th class="element-water">Water</th>
                            <td class="potent">P</td>
                            <td class="neutral">N</td>
                            <td class="neutral">N</td>
                            <td class="potent">P</td>
                            <td class="weak">W</td>
                        </tr>
                        <tr>
                            <th class="element-fire">Fire</th>
                            <td class="weak">W</td>
                            <td class="potent">P</td>
                            <td class="weak">W</td>
                            <td class="neutral">N</td>
                            <td class="neutral">N</td>
                        </tr>
                        <tr>
                            <th class="element-wind">Wind</th>
                            <td class="weak">W</td>
                            <td class="weak">W</td>
                            <td class="potent">P</td>
                            <td class="potent">P</td>
                            <td class="neutral">N</td>
                        </tr>
                    </tbody>
                </table>

                <h4>Attack and Damage</h4>
                <p>Strength Attacks are resisted by the opponent's Defense. Wisdom Attacks are resisted by the opponent's Durability.</p>
                
                <h4>Megin</h4>
                <p>Abilities of your own element cost 15% less Megin, and you regenerate 12% Megin per round.</p>
                
                <h4>Healing</h4>
                <p>You can heal your väsen outside of combat by finding a sacred well or giving them your items.</p>
                
                <h4>Move Priority</h4>
                <p>Swapping > Utility Moves > Attack moves. Player has priority.</p>

                <h4>Attribute Stages</h4>
                <p>Increase or decrease the attribute by 10% per stage, goes from -5 to +5.</p>
            </div>
            <button id="close-combat-tips" class="btn btn-primary">Close</button>
        </div>
    </div>

    <!-- Scripts loaded in dependency order -->
    <script src="js/1-constants.js"></script>
    <script src="js/2-data-abilities.js"></script>
    <script src="js/3-data-vasen.js"></script>
    <script src="js/4-data-items.js"></script>
    <script src="js/5-vasen-instance.js"></script>
    <script src="js/6-battle-system.js"></script>
    <script src="js/7-game-state.js"></script>
    <script src="js/8-ui-controller.js"></script>
    <script src="js/9-main.js"></script>
</body>
</html>

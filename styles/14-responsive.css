/* =============================================================================
   14-responsive.css  —  Battle-log collapsible, touch-action, and all
                         responsive breakpoints (320 px – 1440 px+).

   Sections 27-30 were moved here from 11-modals.css where they were
   misplaced (a modals file should not own the entire layout cascade).
   ============================================================================= */

/* =============================================================================
   COLLAPSIBLE BATTLE LOG (All Sizes)
   ============================================================================= */

/* .battle-log-toggle-btn base styles are in 10-combat.css */

/* Collapsible container */
.battle-log-collapsible {
    /* 2000px is a CSS animation trick: transition from 0 → "large enough to show all content".
       The real rendered height is content-driven, not this value. */
    max-height: 2000px;
    overflow: hidden;
    transition: max-height 0.3s ease;
    /* Tells the browser this element scrolls vertically only.
       Prevents horizontal browser swipe gestures from hijacking scroll on mobile. */
    touch-action: pan-y;
}

.battle-log-collapsible.collapsed {
    max-height: 0;
}

/* =========================================================================
   touch-action hints for scrollable containers
   Improves mobile scroll performance and prevents conflicts with browser
   gestures (back/forward swipe, pull-to-refresh) on touch devices.
   ========================================================================= */
.tab-content,
.zone-list,
.panel-content,
.combat-log,
.vasen-details-panel {
    touch-action: pan-y;
}

/* =============================================================================
   27. RESPONSIVE - DESKTOP (1025px+)
   ============================================================================= */
@media (min-width: 1025px) {
    html, body {
        height: 100%;
        overflow: hidden;
    }

    #game-screen {
        /* Progressive viewport-height stack — see 04-layout.css for explanation */
        height: 100vh;
        height: 100svh;
        height: calc(var(--vh, 1vh) * 100);
        overflow: hidden;
    }

    .game-main {
        grid-template-columns: 300px 1fr 1fr;
        overflow: hidden;
    }

    .panel {
        overflow: hidden;
    }

    .panel-content {
        overflow-y: auto;
    }

    .panel-left {
        grid-column: 1;
    }

    .panel-middle {
        grid-column: 2;
    }

    .panel-right {
        grid-column: 3;
    }
}

/* Large Desktop (1440px+) */
@media (min-width: 1440px) {
    .game-main {
        grid-template-columns: 320px 1fr 1fr;
    }
}

/* Standard Desktop (1025-1439px) */
@media (min-width: 1025px) and (max-width: 1439px) {
    .game-main {
        grid-template-columns: 280px minmax(300px, 400px) 1fr;
    }
}

/* Laptop (short screens) */
@media (min-width: 1025px) and (max-height: 800px) {
    .vasen-details-panel {
        max-height: 40%;
    }

    .combat-log {
        max-height: 120px;
    }
}

/* Three-box layout (desktop) - Make right panel scrollable */
@media (min-width: 1025px) {
    .panel-right {
        display: flex;
        flex-direction: column;
        overflow-y: auto; /* Make scrollable */
        overflow-x: hidden;
        min-height: 0;     /* prevents flex overflow */
    }
}

/* =============================================================================
   28. RESPONSIVE - TABLET (769-1100px)
   ============================================================================= */

/* Medium viewports or short screens - switch combat to column layout */
@media (max-width: 1100px), (max-height: 850px) {

    /* --- EXISTING BEHAVIOR --- */
    .combat-arena {
        flex-direction: column;
        gap: var(--spacing-sm);

        /* NEW: allow children to scroll */
        min-height: 0 !important;
        overflow: visible !important;
    }

    .combatant-panel {
        max-width: 100%;
        width: 100%;
    }

    .combatant-panel .combatant-scroll-inner {
        /* make combatant cards scrollable */
        min-height: 0;
        /* svh = small viewport height (excludes browser chrome) → more stable on mobile */
        max-height: 45vh;
        max-height: 45svh;
        max-height: calc(var(--vh, 1vh) * 45);
        overflow-y: auto;
        overflow-x: hidden;
        touch-action: pan-y; /* Prevents browser from hijacking vertical scroll on touch */
    }

    .combat-versus {
        font-size: var(--font-size-lg);
    }

    /* --- NEW: prevent combat log from covering combatants --- */
    .panel-right {
        display: flex;
        flex-direction: column;
        min-height: 0 !important;
    }

    .combat-area {
        flex: 0 0 auto; /* reserve its own space */
        /* clamp(min, preferred, max) — grows with viewport, never overflows a short screen.
           Old fixed 500px broke on screens ≤ ~800px height (laptop, zoom, docked config). */
        min-height: clamp(280px, 48svh, 500px);
        min-height: clamp(280px, calc(var(--vh, 1vh) * 48), 500px);
    }

    .combat-log {
        flex: 1 1 auto;
        overflow-y: auto;
        min-height: 100px; /* was "100" — missing unit; treated as 0 by browsers */
        touch-action: pan-y;
    }
}


@media (min-width: 769px) and (max-width: 1024px) {
    html, body {
        height: 100%;
        overflow: hidden;
        font-weight: var(--font-weight-normal);
    }

    #game-screen {
        height: 100%;
        display: flex;
        flex-direction: column;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .game-header {
        flex-shrink: 0;
    }

    .game-main {
        display: grid;
        grid-template-columns: 280px 1fr;
        grid-template-rows: auto auto; /* Auto-size rows, let content flow */
        overflow: visible;
        flex: 1 1 auto; /* Allow growth */
        min-height: 0;
    }

    .panel {
        overflow: visible;
    }

    .panel-left {
        grid-column: 1;
        grid-row: 1 / 3; /* Span both rows */
        overflow: visible; /* No independent scroll */
        display: flex;
        flex-direction: column;
    }

    .panel-middle {
        grid-column: 2;
        grid-row: 1;
        min-height: 450px;
        overflow: visible; /* No independent scroll */
    }

    .panel-right {
        grid-column: 2;
        grid-row: 2;
        overflow: visible; /* No independent scroll */
    }

    .panel-content {
        overflow-y: auto;
        overflow-x: visible;
        max-height: 50vh;
        min-height: 200px;
    }

    .vasen-details-panel {
        max-height: 40vh;
        overflow-y: auto;
        overflow-x: visible;
        flex-shrink: 0;
    }

    .zone-section {
        min-height: 200px;
        display: flex;
        flex-direction: column;
    }

    .zone-list {
        flex: 1;
        overflow-y: auto;
        min-height: 80px;
        max-height: 200px;
    }

    .zone-actions {
        flex-shrink: 0;
    }

    .combat-area {
        min-height: auto;
    }

    .combat-log {
        max-height: 150px;
    }

    .screen {
        overflow-y: auto;
        overflow-x: hidden;
        height: 100%;
    }

    .starter-options {
        grid-template-columns: repeat(2, 1fr);
    }
}


/* Short viewports: keep bottom combat actions visible */
@media (max-height: 845px) {
    .panel-right {
        display: flex;
        flex-direction: column;
        min-height: 0;
    }

    .combat-area {
        flex: 1 1 auto;
        min-height: 0;
        display: flex;
        flex-direction: column;
    }

    .combat-log {
        flex: 1 1 auto;
        min-height: 0;
        overflow-y: auto;
    }

    .action-buttons {
        flex-shrink: 0;
    }
}


/* =============================================================================
   29. RESPONSIVE - MOBILE (768px and below)
   ============================================================================= */
@media (max-width: 768px) {
    html, body {
        height: 100%;
        overflow-x: hidden;
        overflow-y: auto;
        font-weight: var(--font-weight-normal);
    }

    #game-screen {
        height: 100%;
        overflow-y: auto;
        overflow-x: hidden;
    }

    .game-header {
        flex-wrap: wrap;
        padding: var(--spacing-sm);
    }

    .header-left {
        flex: 1 1 100%;
        order: 1;
        margin-bottom: var(--spacing-xs);
    }

    .header-title {
        font-size: var(--font-size-base);
    }

    .header-subtitle {
        display: none;
    }

    .header-center {
        order: 2;
        flex: 1;
    }

    .header-right {
        order: 3;
        flex: 0 0 auto;
    }

    .game-main {
        display: flex;
        flex-direction: column;
        grid-template-columns: 1fr;
        grid-template-rows: auto;
        gap: var(--spacing-sm);
        overflow: visible;
    }

    .panel {
        overflow: visible;
    }

    .panel-left,
    .panel-middle,
    .panel-right {
        width: 100%;
        min-height: auto;
        overflow: visible;
        border-right: none;
        border-bottom: 2px solid var(--border-color);
    }

    .panel-content {
        overflow-y: auto;
        overflow-x: hidden;
        min-height: 150px;
        max-height: 45vh;
    }

    .vasen-details-panel {
        max-height: 60vh;
        overflow-y: auto;
        overflow-x: visible;
    }

    .zone-section {
        min-height: 200px;
        display: flex;
        flex-direction: column;
    }

    .zone-list {
        flex: 1;
        overflow-y: auto;
        min-height: 80px;
        max-height: 200px;
    }

    .zone-actions {
        flex-shrink: 0;
    }

    .zone-actions .btn {
        width: 100%;
        padding: var(--spacing-md);
    }

    .combat-area {
        min-height: auto;
    }

    .combat-log {
        max-height: 150px;
    }

    .screen {
        overflow-y: auto;
        overflow-x: hidden;
        height: auto;
        min-height: 100vh;
        min-height: 100svh;
        min-height: calc(var(--vh, 1vh) * 100);
    }

    .dialogue-buttons {
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: center;
    }
}

/* Mobile Landscape */
@media (max-width: 768px) and (orientation: landscape) {
    .combat-arena {
        flex-direction: row;
    }

    .party-slots {
        flex-direction: row;
    }
}

/* Small screens (600px and below) */
@media (max-width: 600px) {
    .combat-arena {
        flex-direction: column;
        gap: var(--spacing-sm);
    }

    .combatant-panel {
        max-width: 100%;
        width: 100%;
    }
}

/* Small Mobile (480px and below) */
@media (max-width: 480px) {
    .party-slots {
        flex-direction: column;
    }

    .action-buttons {
        flex-direction: column;
    }

    .action-buttons .btn {
        width: 100%;
    }

    .game-footer {
        flex-wrap: wrap;
        text-align: center;
    }

    .footer-sep {
        display: none;
    }

    .dialogue-buttons {
        flex-direction: column;
    }
}

/* Very Small Mobile (380px and below) */
@media (max-width: 380px) {
    :root {
        --spacing-md: 12px;
        --spacing-lg: 16px;
    }

    .game-title {
        font-size: 1.75rem;
    }

    .modal-content {
        padding: var(--spacing-md);
    }
}

/* =============================================================================
   30. ACCESSIBILITY
   ============================================================================= */
/* Touch device optimizations */
@media (hover: none) and (pointer: coarse) {
    .btn {
        min-height: 44px;
    }

    .tab-btn {
        min-height: 44px;
    }

    .vasen-card,
    .zone-item,
    .party-slot {
        min-height: 44px;
    }
}


/* Enhanced focus states for accessibility */
button:focus-visible,
.btn:focus-visible {
    outline: 2px solid var(--border-light);
    outline-offset: 2px;
}

/* Tab buttons use .active class for visual state - no extra focus outline needed */
.tab-btn:focus,
.tab-btn:focus-visible {
    outline: none;
}

.vasen-card:focus-visible,
.zone-item:focus-visible,
.party-slot:focus-visible {
    outline: 2px solid var(--accent-secondary);
    outline-offset: 2px;
}

.ability-btn:focus-visible {
    outline: 2px solid var(--border-light);
    outline-offset: 2px;
}

/* Reduce motion for accessibility */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }

    .vasen-card,
    .zone-item,
    .party-slot,
    .ability-btn,
    .starter-card {
        animation: none !important;
    }

    .modal,
    .modal-content {
        animation: none !important;
    }
}
